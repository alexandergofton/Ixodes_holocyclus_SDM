---
title: "Ixodes holocyclus species distribution model"
format: html
---

# Setup
```{r}
setwd("~/Documents/01_Projects/alpha_gal/Ihol_SDM/Ihol_SDM/")

#library(galah)
library(tidyverse)
library(rgbif)
library(raster)
library(geodata)
```

# Get Ihol ALA records
```{r}
# Search for Ixodes holocyclus on GBIF
if (!file.exists("data/ihol_occurrences_gbif.csv")) {
  ihol_gbif <- occ_search(
    scientificName = "Ixodes holocyclus",
    country = "AU",
    hasCoordinate = TRUE,
    limit = 5000,
    year = "1900,2025"
  )

  ihol_data <- ihol_gbif$data

  # Clean and standardise using tidyverse
  ihol_clean <- ihol_data %>%
    select(
      scientificName,
      decimalLatitude,
      decimalLongitude,
      year,
      month,
      day,
      stateProvince,
      locality
    ) %>%
    filter(
      !is.na(decimalLatitude),
      !is.na(decimalLongitude)
    )

  # Save for later use
  write_csv(ihol_clean, "data/ihol_occurrences_gbif.csv")

} else if (file.exists("data/ihol_occurrences_gbif.csv")) {

  ihol_data <- read.csv("data/ihol_occurrences_gbif.csv")
  glimpse(ihol_data)
}
```

# Get climate data
Recommended Workflow:

Start with SILO climate data (5km) - most reliable for Australia
Add MODIS vegetation indices (250m) for seasonal dynamics
Include topographic variables from SRTM (30m)
Use DLCD for land cover (250m)
All aggregated to 1km for consistency with occurrence data

```{r}
# Download WorldClim data (same as used by Raghavan et al.)
# This covers Australia at 1km resolution
worldclim_data <- worldclim_global(
  var = "bio",
  res = 0.5,
  path = "climate_data/"
)

# Get Australian extent
aus_extent <- c(110, 160, -45, -5)  # xmin, xmax, ymin, ymax

# Crop to Australia
bio_vars <- crop(worldclim_data, aus_extent)

# Focus on east coast (where ticks occur)
east_coast_extent <- c(135, 155, -40, -10)
bio_vars_east <- crop(bio_vars, east_coast_extent)

# Save the key variables identified by Raghavan et al.
key_vars <- bio_vars_east[[c(1, 5, 4, 7, 12, 2)]]  # bio1, bio5, bio4, bio7, bio12, bio2
names(key_vars) <- c(
  "annual_mean_temp",
  "max_temp_warmest",
  "temp_seasonality",
  "temp_annual_range",
  "annual_precip",
  "mean_diurnal_range"
)

# Save raster stack
writeRaster(
  key_vars,
  "climate_variables_east_australia.tif",
  overwrite = TRUE
)

# Create a simple map to check
plot(
  key_vars$annual_mean_temp,
  main = "Annual Mean Temperature (Â°C)"
)
```










# Get list of Ihol top hosts
```{r}
# Get list of top Ihol hosts
ihol_host_records <- read.csv("data/ihol_hosts_Barker2023.csv")

ihol_top_hosts <- ihol_host_records |>
  arrange(
    desc(num_hosts),
    desc(total_records)
  ) |>
  head(50) |>
  pull(scientific_name)

ihol_top_hosts
```

## Ihol exotic hosts
```{r}
exotics <- c(
  "Canis familiaris",
  "Felis catus",
  "Bos taurus",
  "Canis lupus",
  "Sus scrofa",
  "Equus caballus",
  "Rattus rattus",
  "Rattus norvegicus",
  "Equus asinus",
  "Capra aegagrus hircus",
  "Ovis aries"
)
```

## Filter native hosts only
```{r}
ihol_top_native_hosts <- tibble(ihol_top_hosts) |>
  filter(!ihol_top_hosts %in% exotics) |>
  filter(!ihol_top_hosts %in% c(
    "Homo sapiens",
    "Rattus sp.",
    "Macropus sp.",
    "Melomys sp.",
    "Uromys sp.",
    "")
  ) |>
  head(20)

ihol_top_native_hosts
```

## Get native hosts ALA records
```{r}
# Extract the vector of species names
native_host_names <- ihol_top_native_hosts$ihol_top_hosts

# Loop through each species and download GBIF data
if (!file.exists("data/ihol_native_hosts_gbif.rds")) {

  ihol_native_hosts_gbif <- list()

  for (i in seq_along(native_host_names)) {
    species <- native_host_names[i]
    cat("Downloading data for species", i, "of", length(native_host_names), ":", species, "\n")

    # Add delay between requests to be respectful to the API
    Sys.sleep(1)

    # Download occurrence data
    result <- occ_search(
      scientificName = species,
      country = "AU",
      hasCoordinate = TRUE,
      limit = 5000,
      year = "1900,2025"
    )

    # Store result
    ihol_native_hosts_gbif[[species]] <- result
  }

  # Save the complete dataset to file
  saveRDS(ihol_native_hosts_gbif, "data/ihol_native_hosts_gbif.rds")

} else if (file.exists("data/ihol_native_hosts_gbif.rds")) {

  # Read back the saved data
  ihol_native_hosts_gbif <- readRDS("data/ihol_native_hosts_gbif.rds")

  # Display summary
  cat("Loaded GBIF data for", length(ihol_native_hosts_gbif), "native host species\n")
}
```

# Heath 1974 key variables

```{r}
temp_low <- 8
temp_optimal <- seq(25, 28, 1)
temp_upper <- 32
```
